<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">

    <!-- http://getbootstrap.com/docs/5.2/ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>

    <!-- https://icons.getbootstrap.com/ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

    <!-- https://favicon.io/emoji-favicons/spiral-calendar/ -->
    <link href="/static/favicon.ico" rel="icon">

    <link href="/static/styles.css" rel="stylesheet">

    <script src="/static/calendar.js"></script>
    <script src="/static/library.js"></script>
    <script>
        var libData = {};

        let data = {};
        let date = new Date();
        Object.defineProperty(data, "date", {
            set(newDate) {
                console.log("date update", newDate);
                date = newDate;
                updateCalendar();
            },
            get() { return date; }
        });

        let library = {};
        Object.defineProperty(data, "library", {
            set(newLibrary) {
                console.log("library update", library, newLibrary);
                if (Object.keys(library).length === 0) {
                    console.log("library was empty", library);
                    toggleLibrary();
                    activateShortcutSelection();
                 };
                library = newLibrary;
                updateShortcutSelection();
                updateTable();
            },
            get() { return library; }
        });

        let filename = "";
        Object.defineProperty(data, "filename", {
            set(newFilename) {
                console.log("filename update", newFilename);
                filename = newFilename;
                toggleLibrary();
                activateShortcutSelection();
            },
            get() { return filename; }
        });
    </script>

    <title>uCal: Calendar</title>

</head>

<body>

    <nav class="bg-light border navbar navbar-light">

        <div class="container py-2">
            <span class="navbar-brand h1 brand-span flex-lg-grow-0 flex-grow-1 text-center text-lg-start m-0 mb-3 mb-lg-0">
                <i class="bi bi-calendar3"></i> uCal
            </span>
            <div class="container-md w-700px">
                <div class="row">
                     <div class="col col-md-auto">
                        <form class="input-group justify-content-center needs-validation active" id="calendar-filename-form" novalidate>
                            <button disabled class="btn btn-nav text-start flex-grow-1 rounded" type="button" id="calendar-nav" data-nav="calendar"><i class="bi bi-calendar3-range"></i> Calendar</button>
                            <input hidden class="form-control text-center border-end-0" id="calendar-filename-input" name="calendar-filename-input" type="text" autocomplete="off" placeholder="calendar name" required>
                            <div class="invalid-tooltip rounded-end">invalid / missing calendar filename</div>
                            <i hidden class="input-group-text border-start-0 rounded-end bi bi-pencil" id="calendar-edit"></i>
                            <button hidden class="btn btn-nav" type="button" id="calendar-save"><i class="bi bi-download" id="calendar-save"></i></button>        
                        </form>
                    </div>
                    <div class="col-md mt-3 mt-md-0">
                        <form class="input-group needs-validation" id="library-filename-form" novalidate>
                            <button class="btn btn-nav" type="button" id="library-nav" data-nav="library"><i class="bi bi-journals me-1"></i> Library</button>
                            <button class="btn btn-nav flex-grow-1" type="button" id="library-new" data-nav="library">Create <i class="bi bi-patch-plus"></i></button>
                            <input hidden class="form-control" type="file" accept=".ucal" id="library-file-input" name="library-file-input">
                            <label class="btn btn-nav flex-grow-1 rounded-end" for="library-file-input" id="library-file-upload">Upload<i class="bi bi-upload ms-1"></i></label>
                            <input hidden disabled class="form-control text-center border-end-0" id="library-filename-input" name="library-filename-input" type="text" autocomplete="off" placeholder="library name" required>
                            <div class="invalid-tooltip rounded-end">invalid / missing library filename</div>
                            <i hidden class="input-group-text border-start-0 rounded-end bi bi-pencil" id="library-edit"></i>
                            <button hidden class="btn btn-nav" type="button" id="library-save"><i class="bi bi-download" id="library-save"></i></button>
                        </form>
                    </div>
                </div>
            </div>
            <span class="brand-span"></span>
        </div>

        <!-- <div class="container justify-content-center py-2">
            <span class="navbar-brand h1 brand-span text-center text-lg-start m-0 mb-3 mb-lg-0">
                <i class="bi bi-calendar3"></i> uCal
            </span>
            <div class="container-md w-700px">
                <div class="row">
                    <form class="col col-md-auto active needs-validation" id="calendar-filename" novalidate>
                        <div class="input-group">
                            <button class="btn btn-nav rounded flex-grow-1 active" type="button" id="calendar-nav">
                                <i class="bi bi-calendar3-range"></i> Calendar
                            </button>
                            <input hidden class="form-control filename-input text-end" id="calendar-filename-input" name="calendar-filename-input" type="text" autocomplete="off" placeholder="filename" required>
                            <label hidden class="input-group-text filename-input" for="calendar-filename-input">.ics</label>
                            <div hidden class="invalid-tooltip rounded">Please choose a name for the Calendar file.</div>
                            <button hidden class="btn btn-nav" type="button" id="calendar-save">
                                <i class="bi bi-download"></i>
                            </button>
                        </div>
                    </form>
                    <form class="col-md  mt-3 mt-md-0 needs-validation" id="library-filename" novalidate>
                        <div class="input-group">
                            <label class="input-group-text">
                                <i class="bi bi-journals me-1"></i> Library
                            </label>
                            <input class="btn-nav form-control" type="file" accept=".ucal" id="library-file" name="library-file" hidden>
                            <label class="btn btn-nav input-group-text flex-grow-1" for="library-file" id="library-file-upload">
                                Upload<i class="bi bi-upload ms-1"></i>
                            </label>
                            <input hidden class="form-control filename-input text-end" id="calendar-filename-input" name="calendar-filename-input" type="text" autocomplete="off" placeholder="filename" required>
                            <label hidden class="input-group-text filename-input" for="calendar-filename-input">.ucal</label>
                            <button hidden class="btn btn-nav" type="button" id="calendar-save">
                                <i class="bi bi-download"></i>
                            </button>
                            <span class="input-group-text bg-transparent" id="library-file-filename" hidden></span>
                            <button class="btn btn-nav flex-grow-1" type="button" id="library-nav" data-nav="library">
                                <span id="library-nav-new">Create <i class="bi bi-patch-plus"></i></span>
                                <span id="library-nav-edit" hidden>Edit <i class="bi bi-pencil"></i></span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <span class="brand-span"></span>
        </div>

        <div class="container justify-content-center py-2">
            <span class="navbar-brand h1 brand-span text-center text-lg-start m-0 mb-3 mb-lg-0">
                <i class="bi bi-calendar3"></i> uCal
            </span>
            <div class="container-md w-700px">
                <div class="row">
                    <form class="col active needs-validation" id="calendar-filename" novalidate>
                        <div class="input-group">
                            <button class="btn btn-nav active" type="button" id="calendar-nav">
                                <i class="bi bi-calendar3-range"></i> Calendar
                            </button>
                            <input class="form-control text-end" id="calendar-filename-input" name="calendar-filename-input" type="text" autocomplete="off" placeholder="filename" required>
                            <label hidden class="input-group-text filename-input" for="calendar-filename-input">.ics</label>
                            <div class="invalid-tooltip rounded">Please choose a name for the Calendar file.</div>
                            <button class="btn btn-nav" type="button" id="calendar-save">
                                <i class="bi bi-download"></i>
                            </button>
                        </div>
                    </form>
                    <form class="col flex-grow-1 mt-3 mt-md-0 needs-validation" id="library-filename" novalidate>
                        <div class="input-group">
                            <label class="input-group-text">
                                <i class="bi bi-journals me-1"></i> Library
                            </label>
                            <input class="btn-nav form-control" type="file" accept=".ucal" id="library-file" name="library-file" hidden>
                            <label hidden class="btn btn-nav input-group-text flex-fill" for="library-file" id="library-file-upload">
                                Upload<i class="bi bi-upload ms-1"></i>
                            </label>
                            <input hidden class="form-control text-end pe-6" id="calendar-filename-input" name="calendar-filename-input" type="text" autocomplete="off" placeholder="filename" value="filename" required>
                            <label hidden class="input-group-text filename-input" for="calendar-filename-input">.ucal</label>
                            <span class="input-group-text flex-grow-1 border-start-0" id="library-file-filename">filename</span>
                            <button hidden class="btn btn-nav" type="button" id="calendar-save">
                                <i class="bi bi-download"></i>
                            </button>
                            <button class="btn btn-nav" type="button" id="library-nav" data-nav="library">
                                <span id="library-nav-new" hidden>New <i class="bi bi-patch-plus"></i></span>
                                <span id="library-nav-edit"><i class="bi bi-pencil"></i></span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <span class="brand-span"></span>
        </div> -->

        <!-- <div class="container justify-content-center py-2">
            <span class="navbar-brand h1 brand-span text-center text-lg-start m-0 mb-3 mb-lg-0">
                <i class="bi bi-calendar3"></i> uCal
            </span>
            <div class="container-md w-700px">
                <div class="row">
                    <form class="col needs-validation" id="calendar-filename-form" novalidate>
                        <div class="input-group">
                            <button class="btn btn-nav" type="button" id="calendar-nav">
                                <i class="bi bi-calendar3-range"></i> Calendar
                            </button>
                            <input class="form-control text-end" disabled id="calendar-filename-input" name="calendar-filename-input" type="text" autocomplete="off" placeholder="filename" required>
                            <label hidden class="input-group-text filename-input" for="calendar-filename-input">.ics</label>
                            <div class="invalid-tooltip rounded">Please choose a name for the Calendar file.</div>
                            <button hidden class="btn btn-nav" type="button" id="calendar-save">
                                <i class="bi bi-download"></i>
                            </button>
                            <button class="btn btn-nav" type="button" id="calendar-edit">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </div>
                    </form>
                    <form class="col-md mt-3 mt-md-0 needs-validation" id="library-filename" novalidate>
                        <div class="input-group">
                            <label class="input-group-text btn btn-nav pe-none active">
                                <i class="bi bi-journals me-1"></i> Library
                            </label>
                            <input class="btn-nav form-control" type="file" accept=".ucal" id="library-file" name="library-file" hidden>
                            <label hidden class="btn btn-nav input-group-text flex-fill" for="library-file" id="library-file-upload">
                                Upload<i class="bi bi-upload ms-1"></i>
                            </label>
                            <input hidden class="form-control text-end pe-6" id="calendar-filename-input" name="calendar-filename-input" type="text" autocomplete="off" placeholder="filename" value="filename" required>
                            <label hidden class="input-group-text filename-input" for="calendar-filename-input">.ucal</label>
                            <span hidden class="input-group-text flex-grow-1 border-start-0" id="library-file-filename">filename</span>
                            <input class="form-control text-end" id="calendar-filename-input" name="calendar-filename-input" type="text" autocomplete="off" placeholder="filename" required>
                            <button hidden class="btn btn-nav" type="button" id="calendar-save">
                                <i class="bi bi-download"></i>
                            </button>
                            <button class="btn btn-nav" type="button" id="library-nav" data-nav="library">
                                <span id="library-nav-new" hidden>New <i class="bi bi-patch-plus"></i></span>
                                <span id="library-nav-edit"><i class="bi bi-pencil"></i></span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <span class="brand-span"></span>
        </div> -->

        <script>
            document.getElementById("library-file-input").addEventListener("input", loadLibrary, false);

            document.getElementById("calendar-nav").addEventListener("click", toggleNav);

            document.getElementById("library-nav").addEventListener("click", toggleNav);
            document.getElementById("library-new").addEventListener("click", toggleNav);

            document.getElementById("calendar-save").addEventListener("click", saveCalendar);

            document.getElementById("library-save").addEventListener("click", saveLibrary);

            document.getElementById("calendar-filename-input").addEventListener("input", checkFilename);
            document.getElementById("library-filename-input").addEventListener("input", checkFilename);

            document.getElementById("calendar-filename-input").addEventListener("focusout", uncheckFilename);
            document.getElementById("library-filename-input").addEventListener("focusout", uncheckFilename);

        </script>

    </nav>

    <main class="container py-5 text-center" id="calendar">

        <div class="w-700px container-md">

            <form class="needs-validation" novalidate>
                <div class="row">
                    <div class="input-group has-validation justify-content-center">
                        <button class="btn btn-click" id="calendar-date-before" type="button" data-direction="-1">
                            <i class="bi bi-caret-left-fill"></i>
                        </button>
                        <input class="form-control text-center" id="calendar-date-input" value="" type="text">
                        <div class="valid-tooltip rounded" id="calendar-date-tooltip">Looks good!</div>
                        <div class="invalid-tooltip rounded">invalid [MM / YYYY]</div>
                        <button class="btn btn-click" id="calendar-date-after" type="button" data-direction="+1">
                            <i class="bi bi-caret-right-fill"></i>
                        </button>
                    </div>
                </div>

            </form>

            <hr>

            <form class="needs-validation" id="calendar-form" novalidate>
                <div class="row mb-3 deactivated" id="calendar-shortcut">
                    <input type="radio" class="btn-check" name="toggle-shortcut" id="toggle-shortcut" hidden checked>
                    <div class="col input-group flex-nowrap btn-toggle-on w-100" id="toggle-shortcut-add" data-toggle="add">
                        <button class="btn btn-toggle input-group-text" type="button">
                            <i class="bi bi-journal-plus"></i> <i class="bi bi-arrow-right"></i> <i
                                class="bi bi-calendar3-event"></i>
                        </button>
                        <select class="btn btn-toggle form-select text-start" id="calendar-shortcut-selection">
                            <option value="" disabled selected>add shortcut...</option>
                        </select>
                    </div>
                    <div class="col-sm-auto btn-toggle-off mt-3 mt-sm-0" id="toggle-shortcut-clear">
                        <button class="btn btn-toggle input-group-text w-100 text-start" type="button">
                            <i class="bi bi-calendar3-event"></i> <i class="bi bi-arrow-right"></i> <i
                                class="bi bi-trash3 me-4 me-sm-2"></i>clear day
                        </button>
                    </div>
                </div>

                <div class="text-center deactivated" id="calendar-calendar">

                </div>
            </form>

            <!-- <hr>

            <form class="needs-validation" id="calendar-filename" novalidate>
                <div class="row mb-3">
                    <div class="col">
                        <div class="input-group mb-3 mb-sm-0 has-validation">
                            <span class="input-group-text">
                                <i class="bi bi-calendar3-range me-2"></i>Calendar
                            </span>
                            <input class="form-control filename-input text-end pe-1" id="calendar-filename-input"name="calendar-filename-input" type="text" autocomplete="off" placeholder="filename" required>
                            <div class="invalid-tooltip">Please choose a name for the Calendar file.</div>
                            <label class="input-group-text filename-input" for="calendar-filename-input">.ics</label>
                        </div>
                    </div>
                    <div class="col-sm-auto col-md-5">
                        <button class="btn btn-dark w-100" type="button" id="calendar-save">
                            <i class="bi bi-download"></i> Download
                        </button>
                    </div>
                </div>
            </form> -->

        </div>

        <template id="template-calendar-header">
            <div class="row mx-auto" id="calendar-header">
                <label class="col col-form-label overflow-hidden px-0">Mon</label>
                <label class="col col-form-label overflow-hidden px-0">Tue</label>
                <label class="col col-form-label overflow-hidden px-0">Wed</label>
                <label class="col col-form-label overflow-hidden px-0">Thu</label>
                <label class="col col-form-label overflow-hidden px-0">Fri</label>
                <label class="col col-form-label overflow-hidden px-0">Sat</label>
                <label class="col col-form-label overflow-hidden px-0">Sun</label>
            </div>
        </template>

        <template class="day" id="template-calendar-day">
            <button class="col-sm col-1 flex-fill btn btn-day p-0" type="button">
                <label class="w-100" role="button"></label>
                <textarea class="text-center w-100 bg-transparent border-0" role="button" disabled autocomplete="off"></textarea>
            </button>
        </template>

        <script>
            document.getElementById("calendar-date-input").addEventListener("focus", editCalendarDate);
            document.getElementById("calendar-date-input").addEventListener("input", checkCalendarDate);
            document.getElementById("calendar-date-input").addEventListener("focusout", acceptCalendarDate);

            document.getElementById("calendar-date-before").addEventListener("click", changeCalendarDate);
            document.getElementById("calendar-date-after").addEventListener("click", changeCalendarDate);

            document.getElementById("calendar-shortcut-selection").addEventListener("change", activateCalendar);

            document.getElementById("toggle-shortcut-add").addEventListener("click", toggleShortcut);
            document.getElementById("toggle-shortcut-clear").addEventListener("click", toggleShortcut);

            window.addEventListener("load", updateCalendar());
        </script>

    </main>

    <main class="container py-5 text-center" id="library" hidden>
        <div class="w-700px container-sm">
            <form class="text-start text-sm-end needs-validation" id="shortcut-form" novalidate>
                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-shortcut">Shortcut</label>
                    <div class="col">
                        <div class="input-group has-validation">
                            <i class="input-group-text bi bi-ticket-fill"></i>
                            <input class="form-control" id="shortcut-shortcut" name="shortcut-shortcut" type="text"
                                autofocus autocomplete="off" required>
                            <div class="invalid-tooltip rounded">missing unique shortcut</div>
                            <div class="invalid-tooltip used-tooltip rounded">already used shortcut, will overwrite!
                            </div>
                            <button class="col-sm-3 btn btn-nav w-auto" type="button" id="shortcut-add">
                                <i class="bi bi-journal-plus"></i> <i class="bi bi-arrow-right"></i> <i
                                    class="bi bi-journals"></i> Library
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-subject">Subject</label>
                    <div class="col input-group has-validation">
                        <i class="input-group-text bi bi-calendar2-fill"></i>
                        <input class="form-control has-validation" id="shortcut-subject" name="shortcut-subject"
                            type="text" autocomplete="off" required>
                        <div class="invalid-tooltip">missing subject</div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-begin">Time</label>
                    <input type="radio" class="btn-check" name="toggle-time" id="toggle-time" hidden>
                    <div class="col input-group flex-nowrap btn-toggle btn-toggle-off has-validation" id="toggle-time-time" data-toggle="time">
                        <i class="btn btn-toggle input-group-text bi bi-clock-fill"></i>
                        <input class="btn-toggle form-control text-end" id="shortcut-begin" name="shortcut-begin" type="text" placeholder="12:00" required>
                        <i class="btn btn-toggle border-start-0 border-end-0 input-group-text bi bi-dash-lg bg-transparent"></i>
                        <input class="btn-toggle form-control" id="shortcut-end" name="shortcut-end" type="text" placeholder="13:00" required>
                        <div class="invalid-tooltip">missing / invalid time <i class="bi bi-arrow-right"></i> 12 | 1200 | 12:00</div>
                    </div>
                    <div class="col-sm-auto btn-toggle-on mt-3 mt-sm-0 text-center" id="toggle-time-allday" data-toggle="allday">
                        <button class="btn btn-toggle input-group-text w-100 text-start" type="button">
                            <i class="bi bi-circle-half me-4 me-sm-2"></i>all-day
                        </button>
                    </div>
                </div>

                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-location">Location</label>
                    <div class="col input-group">
                        <i class="input-group-text bi bi-pin-map"></i>
                        <input class="form-control" id="shortcut-location" name="shortcut-location" type="text"
                            autocomplete="off">
                    </div>
                </div>

                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-description">Notes</label>
                    <div class="col input-group">
                        <label class="input-group-text align-items-start"><i class="bi bi-card-text"></i></label>
                        <textarea class="form-control" id="shortcut-description" name="shortcut-description"></textarea>
                    </div>
                </div>
            </form>

            <!-- <hr>

            <form class="text-start text-sm-end needs-validation" id="library-filename" novalidate>
                <div class="row">
                    <label class="col-sm-2 col-form-label" for="library-filename-input">Library</label>
                    <div class="col flex-nowrap input-group has-validation mb-3 mb-sm-0">
                        <i class="input-group-text bi bi-journals"></i>
                        <input class="form-control text-end pe-1" id="library-filename-input"
                            name="library-filename-input" type="text" autocomplete="off" placeholder="filename"
                            required>
                        <span class="input-group-text ps-1">.ucal</span>
                        <div class="invalid-tooltip">missing library name</div>
                    </div>
                    <div class="col-sm-auto col-md-4">
                        <button class="btn btn-dark w-100" type="button" id="library-save">
                            <i class="bi bi-download"></i> Download
                        </button>
                    </div>
                </div>
            </form> -->

            <hr>

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Shortcut</th>
                        <th scope="col">Subject</th>
                        <th scope="col">Time</th>
                        <th scope="col">Location</th>
                        <th scope="col">Notes</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <script>
            document.getElementById("shortcut-add").addEventListener("click", addShortcut);

            document.getElementById("shortcut-shortcut").addEventListener("input", checkShort);

            document.getElementById("toggle-time-time").addEventListener("click", toggleTime);
            document.getElementById("toggle-time-allday").addEventListener("click", toggleTime);

            document.getElementById("shortcut-begin").addEventListener("input", checkTime);
            document.getElementById("shortcut-end").addEventListener("input", checkTime);
        </script>

    </main>

    <hr>

    <footer class="mb-5 small text-center text-muted">

        <span class="me-3"><i class="bi bi-chevron-expand"></i> challenged by <a class="text-reset" href="https://cs50.harvard.edu/x/2022/">cs50</a></span>
        <span class="ms-3"><i class="bi bi-code"></i> coded by <a class="text-reset" href="https://github.com/urmoi/">urmoi</a></span>
    
    </footer>

</body>

</html>
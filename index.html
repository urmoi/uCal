<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">

    <!-- http://getbootstrap.com/docs/5.2/ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>

    <!-- https://icons.getbootstrap.com/ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

    <!-- https://favicon.io/emoji-favicons/spiral-calendar/ -->
    <link href="/static/favicon.ico" rel="icon">

    <link href="/static/styles.css" rel="stylesheet">

    <script src="/static/calendar.js"></script>
    <script src="/static/library.js"></script>
    <script>
        var libData = {};

        // var dateData = {
        //     value: new Date(),
        //     letMeKnow() {
        //         console.log(`The variable has changed to ${this.dates}`);
        //     },
        //     get dates() {
        //         return this.value;
        //     },
        //     set dates(value) {
        //         this.value = value;
        //         this.letMeKnow();
        //         // updateCalendarDate();
        //         // makeCalendar();
        //     },
        //     enumerable:true,
        // }

        // var inputDate = document.getElementById("calendar-date-date");
        // var valueDate = inputDate.value;
        // Object.defineProperty(document.getElementById("calendar-date-date"), "value", {
        //     set(newValueDate) {
        //         console.log("Value changed to", newValueDate);
        //         valueDate = newValueDate;
        //         // inputDate.value = newValueDate;
        //         updateCalendarDate();
        //         makeCalendar();
        //     },
        //     get(){
        //         return valueDate;
        //     }
        // });

        let data = {};
        let date = new Date();
        Object.defineProperty(data, "date", {
            set(newDate) {
                date = newDate;
                updateCalendar();
            },
            get() { return date; }
        });
    </script>

    <title>uCal: Calendar</title>

</head>

<body>

    <nav class="bg-light border navbar navbar-light">

        <div class="container justify-content-center py-2">
            <span class="navbar-brand h1 brand-span text-center text-lg-start m-0 mb-3 mb-lg-0">
                <i class="bi bi-calendar3"></i> uCal
            </span>
            <div class="container-md w-700px">
                <div class="row">
                    <div class="col input-group">
                        <label class="btn btn-click input-group-text" for="library-file">
                            Upload <i class="bi bi-upload"></i> <i class="bi bi-journals"></i> Library
                        </label>
                        <input class="btn-click form-control" type="file" accept=".ucal" id="library-file" name="library-file">
                    </div>
                    <div class="col-md-auto mt-3 mt-md-0">
                        <button class="btn btn-click w-100" type="button" id="library-new">
                            New <i class="bi bi-patch-plus"></i> <i class="bi bi-journals"></i> Library
                        </button>
                    </div>
                </div>
            </div>
            <span class="brand-span"></span>
        </div>

        <script>
            document.getElementById("library-new").addEventListener("click", () => {
                console.log("switch to library");
                document.getElementById("calendar").hidden = !document.getElementById("calendar").hidden//true;
                document.getElementById("library").hidden = !document.getElementById("calendar").hidden//false;
            });
        </script>

    </nav>

    <main class="container py-5 text-center" id="calendar">

        <div class="w-700px container-md">

            <form class="needs-validation" novalidate>
                <div class="row">
                    <div class="input-group has-validation justify-content-center">
                        <button class="btn btn-click" id="calendar-date-before" type="button" data-direction="-1">
                            <i class="bi bi-caret-left-fill"></i>
                        </button>
                        <input class="form-control text-center" id="calendar-date-input" value="" type="text">
                        <div class="valid-tooltip rounded" id="calendar-date-tooltip">Looks good!</div>
                        <div class="invalid-tooltip rounded">invalid [MM / YYYY]</div>
                        <button class="btn btn-click" id="calendar-date-after" type="button" data-direction="+1">
                            <i class="bi bi-caret-right-fill"></i>
                        </button>
                    </div>
                </div>

            </form>

            <hr>

            <form class="needs-validation" id="calendar-form" novalidate>
                <div class="row mb-3 deactivated" id="calendar-shortcut">
                    <input type="radio" class="btn-check" name="toggle-shortcut" id="toggle-shortcut" hidden checked>
                    <div class="col input-group flex-nowrap btn-toggle-on w-100" id="toggle-shortcut-add" data-toggle="add">
                        <button class="btn btn-toggle input-group-text" type="button">
                            <i class="bi bi-journal-plus"></i> <i class="bi bi-arrow-right"></i> <i
                                class="bi bi-calendar3-event"></i>
                        </button>
                        <select class="btn btn-toggle form-select text-start" id="calendar-shortcut-selection">
                            <option value="" disabled selected>add shortcut...</option>
                        </select>
                    </div>
                    <div class="col-sm-auto btn-toggle-off mt-3 mt-sm-0" id="toggle-shortcut-clear">
                        <button class="btn btn-toggle input-group-text w-100 text-start" type="button">
                            <i class="bi bi-calendar3-event"></i> <i class="bi bi-arrow-right"></i> <i
                                class="bi bi-trash3 me-4 me-sm-2"></i>clear day
                        </button>
                    </div>
                </div>

                <div class="mb-3 text-center deactivated" id="calendar-calendar">

                </div>
            </form>

            <hr>

            <form class="needs-validation" id="calendar-filename" novalidate>
                <div class="row mb-3">
                    <div class="col">
                        <div class="input-group mb-3 mb-sm-0 has-validation">
                            <span class="input-group-text">
                                <i class="bi bi-calendar3-range me-2"></i>Calendar
                            </span>
                            <input class="form-control text-end pe-1" id="calendar-filename-input"
                                name="calendar-filename-input" type="text" autocomplete="off" placeholder="filename"
                                required>
                            <span class="input-group-text ps-1">.cls</span>
                            <div class="invalid-tooltip">Please choose a name for the Calendar file.</div>
                        </div>
                    </div>
                    <div class="col-sm-auto col-md-5">
                        <button class="btn btn-dark w-100" type="button" id="calendar-save">
                            <i class="bi bi-download"></i> Download
                        </button>
                    </div>
                </div>
            </form>

        </div>

        <template id="template-calendar-header">
            <div class="row mx-auto" id="calendar-header">
                <label class="col col-form-label overflow-hidden px-0">Mon</label>
                <label class="col col-form-label overflow-hidden px-0">Tue</label>
                <label class="col col-form-label overflow-hidden px-0">Wed</label>
                <label class="col col-form-label overflow-hidden px-0">Thu</label>
                <label class="col col-form-label overflow-hidden px-0">Fri</label>
                <label class="col col-form-label overflow-hidden px-0">Sat</label>
                <label class="col col-form-label overflow-hidden px-0">Sun</label>
            </div>
        </template>

        <template class="day" id="template-calendar-day">
            <button class="col btn btn-day p-0" type="button">
                <label class="w-100" role="button"></label>
                <textarea class="text-center w-100 bg-transparent border-0" role="button" disabled autocomplete="off"></textarea>
            </button>
        </template>

        <script>
            document.getElementById("library-file").addEventListener("input", loadLibrary);
            document.getElementById("library-file").addEventListener("input", activateCalendar);

            document.getElementById("calendar-save").addEventListener("click", saveCalendar);

            document.getElementById("calendar-filename-input").addEventListener("input", checkFilename);

            document.getElementById("calendar-date-input").addEventListener("focus", editCalendarDate);
            document.getElementById("calendar-date-input").addEventListener("input", checkCalendarDate);
            document.getElementById("calendar-date-input").addEventListener("focusout", acceptCalendarDate);

            document.getElementById("calendar-date-before").addEventListener("click", changeCalendarDate);
            document.getElementById("calendar-date-after").addEventListener("click", changeCalendarDate);

            document.getElementById("calendar-shortcut-selection").addEventListener("change", activateCalendar);

            document.getElementById("toggle-shortcut-add").addEventListener("click", toggleShortcut);
            document.getElementById("toggle-shortcut-clear").addEventListener("click", toggleShortcut);

            window.addEventListener("load", updateCalendar());
        </script>

    </main>

    <main class="container py-5 text-center" id="library" hidden>
        <div class="w-700px container-sm">
            <form class="text-start text-sm-end needs-validation" id="shortcut-form" novalidate>
                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-shortcut">Shortcut</label>
                    <div class="col">
                        <div class="input-group has-validation">
                            <i class="input-group-text bi bi-ticket-fill"></i>
                            <input class="form-control" id="shortcut-shortcut" name="shortcut-shortcut" type="text"
                                autofocus autocomplete="off" required>
                            <div class="invalid-tooltip rounded">missing unique shortcut</div>
                            <div class="invalid-tooltip used-tooltip rounded">already used shortcut, will overwrite!
                            </div>
                            <button class="col-sm-3 btn btn-dark w-auto" type="button" id="shortcut-add">
                                <i class="bi bi-journal-plus"></i> <i class="bi bi-arrow-right"></i> <i
                                    class="bi bi-journals"></i> Library
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-subject">Subject</label>
                    <div class="col input-group has-validation">
                        <i class="input-group-text bi bi-calendar2-fill"></i>
                        <input class="form-control has-validation" id="shortcut-subject" name="shortcut-subject"
                            type="text" autocomplete="off" required>
                        <div class="invalid-tooltip">missing subject</div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-begin">Time</label>
                    <input type="radio" class="btn-check" name="toggle-time" id="toggle-time" hidden>
                    <div class="col input-group flex-nowrap btn-toggle btn-toggle-off has-validation"
                        id="toggle-time-time">
                        <i class="btn btn-toggle input-group-text bi bi-clock-fill"></i>
                        <input class="btn-toggle form-control text-end" id="shortcut-begin" name="shortcut-begin"
                            type="text" placeholder="12:00" required>
                        <i
                            class="btn btn-toggle border-start-0 border-end-0 input-group-text bi bi-dash-lg bg-transparent"></i>
                        <input class="btn-toggle form-control" id="shortcut-end" name="shortcut-end" type="text"
                            placeholder="13:00" required>
                        <div class="invalid-tooltip">missing / invalid time <i class="bi bi-arrow-right"></i> 12 | 1200
                            | 12:00</div>
                    </div>
                    <div class="col-sm-auto btn-toggle-on mt-3 mt-sm-0 text-center" id="toggle-time-allday">
                        <button class="btn btn-toggle input-group-text w-100 text-start" type="button">
                            <i class="bi bi-circle-half me-4 me-sm-2"></i>all-day
                        </button>
                    </div>
                </div>

                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-location">Location</label>
                    <div class="col input-group">
                        <i class="input-group-text bi bi-pin-map"></i>
                        <input class="form-control" id="shortcut-location" name="shortcut-location" type="text"
                            autocomplete="off">
                    </div>
                </div>

                <div class="row mb-3">
                    <label class="col-sm-2 col-form-label" for="shortcut-description">Notes</label>
                    <div class="col input-group">
                        <label class="input-group-text align-items-start"><i class="bi bi-card-text"></i></label>
                        <textarea class="form-control" id="shortcut-description" name="shortcut-description"></textarea>
                    </div>
                </div>
            </form>

            <hr>

            <form class="text-start text-sm-end needs-validation" id="library-filename" novalidate>
                <div class="row">
                    <label class="col-sm-2 col-form-label" for="library-filename-input">Library</label>
                    <div class="col flex-nowrap input-group has-validation mb-3 mb-sm-0">
                        <i class="input-group-text bi bi-journals"></i>
                        <input class="form-control text-end pe-1" id="library-filename-input"
                            name="library-filename-input" type="text" autocomplete="off" placeholder="filename"
                            required>
                        <span class="input-group-text ps-1">.ucal</span>
                        <div class="invalid-tooltip">missing library name</div>
                    </div>
                    <div class="col-sm-auto col-md-4">
                        <button class="btn btn-dark w-100" type="button" id="library-save">
                            <i class="bi bi-download"></i> Download
                        </button>
                    </div>
                </div>
            </form>

            <hr>

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Shortcut</th>
                        <th scope="col">Subject</th>
                        <th scope="col">Time</th>
                        <th scope="col">Location</th>
                        <th scope="col">Notes</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <script>
            document.getElementById("library-save").addEventListener("click", () => saveLibrary());

            document.getElementById("library-filename-input").addEventListener("input", checkFilename);


            document.getElementById("shortcut-add").addEventListener("click", () => addItem());
            document.getElementById("shortcut-add").addEventListener("click", () => updateTable());

            document.getElementById("shortcut-shortcut").addEventListener("input", (e) => checkShort(e.srcElement));

            document.getElementById("toggle-time-time").addEventListener("click", (e) => toggleTime(true, e.currentTarget));
            document.getElementById("toggle-time-allday").addEventListener("click", (e) => toggleTime(false, e.currentTarget));

            document.getElementById("shortcut-begin").addEventListener("input", (e) => checkTime(e.srcElement));
            document.getElementById("shortcut-end").addEventListener("input", (e) => checkTime(e.srcElement));
        </script>

    </main>

    <hr>

    <footer class="mb-5 small text-center text-muted">

        <span class="me-3"><i class="bi bi-chevron-expand"></i> challenged by <a class="text-reset" href="https://cs50.harvard.edu/x/2022/">cs50</a></span>
        <span class="ms-3"><i class="bi bi-code"></i> coded by <a class="text-reset" href="https://github.com/urmoi/">urmoi</a></span>
    
    </footer>

</body>

</html>